<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Training Classification Models – fastml 0.6.1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-bb05f5d0074da2129d766b238819cd35.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">fastml 0.6.1</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../getting-started.html"> 
<span class="menu-text">Getting Started</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="../tutorials/fastml-classification.html">
 <span class="dropdown-text">Classification Workflows</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials/fastml-regression.html">
 <span class="dropdown-text">Regression Workflows</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials/fastexplore.html">
 <span class="dropdown-text">Exploring Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tutorials/fastexplain.html">
 <span class="dropdown-text">Model Explainability</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../reference/index.html"> 
<span class="menu-text">Reference</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#load-packages-and-data" id="toc-load-packages-and-data" class="nav-link active" data-scroll-target="#load-packages-and-data">1. Load Packages and Data</a></li>
  <li><a href="#train-many-models-in-one-shot" id="toc-train-many-models-in-one-shot" class="nav-link" data-scroll-target="#train-many-models-in-one-shot">2. Train Many Models in One Shot</a></li>
  <li><a href="#compare-model-performance" id="toc-compare-model-performance" class="nav-link" data-scroll-target="#compare-model-performance">3. Compare Model Performance</a></li>
  <li><a href="#inspect-tuned-hyperparameters" id="toc-inspect-tuned-hyperparameters" class="nav-link" data-scroll-target="#inspect-tuned-hyperparameters">4. Inspect Tuned Hyperparameters</a></li>
  <li><a href="#confusion-matrix" id="toc-confusion-matrix" class="nav-link" data-scroll-target="#confusion-matrix">5. Confusion Matrix</a></li>
  <li><a href="#visualize-model-performance" id="toc-visualize-model-performance" class="nav-link" data-scroll-target="#visualize-model-performance">6. Visualize Model Performance</a></li>
  <li><a href="#visualize-roc-curves" id="toc-visualize-roc-curves" class="nav-link" data-scroll-target="#visualize-roc-curves">7. Visualize ROC Curves</a></li>
  <li><a href="#visualize-calibration-plots" id="toc-visualize-calibration-plots" class="nav-link" data-scroll-target="#visualize-calibration-plots">8. Visualize Calibration Plots</a></li>
  <li><a href="#predictions-on-new-data" id="toc-predictions-on-new-data" class="nav-link" data-scroll-target="#predictions-on-new-data">9. Predictions on New Data</a></li>
  <li><a href="#model-explainability" id="toc-model-explainability" class="nav-link" data-scroll-target="#model-explainability">10. Model Explainability</a></li>
  <li><a href="#advanced-options-cheatsheet" id="toc-advanced-options-cheatsheet" class="nav-link" data-scroll-target="#advanced-options-cheatsheet">Advanced Options Cheat‑Sheet</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Training Classification Models</h1>
</div>



<div class="quarto-title-meta column-page-left">

    
  
    
  </div>
  


</header>


<p>The <code>fastml()</code> function lies at the heart of the fastml package, providing a unified pipeline for training and evaluating classification models with minimal code. It handles everything from data preprocessing to hyperparameter tuning, cross-validation, and model comparison — all in a single step.</p>
<p>In this tutorial, we’ll walk through a complete binary classification workflow using the iris dataset. You’ll learn how to prepare your data, train multiple models at once, evaluate their performance, and interpret the results. Whether you’re a beginner or an experienced user, this example will show you how to streamline your classification tasks using fastml.</p>
<hr>
<section id="load-packages-and-data" class="level2">
<h2 class="anchored" data-anchor-id="load-packages-and-data">1. Load Packages and Data</h2>
<p>We begin by loading the necessary packages: <code>fastml</code> for model training and evaluation, and <code>dplyr</code> for data manipulation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fastml)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To keep things simple for this introductory classification tutorial, we’ll use a modified version of the classic <code>iris</code> dataset. Specifically, we’ll filter out the “<code>setosa</code>” species to turn the problem into a binary classification task — predicting whether a sample belongs to versicolor or virginica.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>iris_bin <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Species <span class="sc">!=</span> <span class="st">"setosa"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">factor</span>(Species))</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris_bin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
1          7.0         3.2          4.7         1.4 versicolor
2          6.4         3.2          4.5         1.5 versicolor
3          6.9         3.1          4.9         1.5 versicolor
4          5.5         2.3          4.0         1.3 versicolor
5          6.5         2.8          4.6         1.5 versicolor
6          5.7         2.8          4.5         1.3 versicolor</code></pre>
</div>
</div>
<p>Although <code>fastml()</code> supports multi-class classification, we use a binary task here to simplify the initial visualization and performance interpretation. This approach makes it easier to follow the modeling process while still demonstrating the core capabilities of the <code>fastml</code> package.</p>
<hr>
</section>
<section id="train-many-models-in-one-shot" class="level2">
<h2 class="anchored" data-anchor-id="train-many-models-in-one-shot">2. Train Many Models in One Shot</h2>
<p>Once your data is ready, training and comparing multiple classification models is as simple as one function call with <code>fastml()</code>. Specify the dataset, the target label, and the algorithms you want to evaluate:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">fastml</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="at">data        =</span> iris_bin,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="at">label       =</span> <span class="st">"Species"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="at">algorithms  =</span> <span class="fu">c</span>(<span class="st">"logistic_reg"</span>,         </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">"svm_rbf"</span>,             </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">"rand_forest"</span>,        </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">"xgboost"</span>)              </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All major components of a typical machine learning pipeline—data splitting, preprocessing, cross-validation, and hyperparameter tuning—are handled automatically, yet remain fully customizable via function arguments.</p>
<p><strong>What just happened?</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 83%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Automated task</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><strong>Stratified train/test split</strong> based on <code>test_size = 0.2</code> (unless train_data/test_data are provided).</td>
</tr>
<tr class="even">
<td>2</td>
<td><strong>Automatic preprocessing recipe</strong>, including dummy-encoding for categorical variables, centering and scaling of numeric predictors, and removal of zero-variance features.</td>
</tr>
<tr class="odd">
<td>3</td>
<td><strong>10-fold cross-validation</strong> within the training set using<code>resampling_method = "cv"</code> and <code>folds = 10</code>.</td>
</tr>
<tr class="even">
<td>4</td>
<td><strong>Model-specific hyperparameter tuning</strong> via grid search (or Bayesian optimization if <code>tuning_strategy = "bayes"</code>)</td>
</tr>
<tr class="odd">
<td>5</td>
<td><strong>Metric collection and model selection</strong>, finalizing the best workflow for each algorithm.</td>
</tr>
</tbody>
</table>
<hr>
<p>Each component can be adjusted through the arguments of <code>fastml()</code> — for instance, you can specify your own <code>recipe</code>, choose from multiple <code>resampling_method</code> types (e.g., “<code>repeatedcv</code>” or “<code>boot</code>”), and even define custom imputation or summary functions.</p>
<p>By default, if <code>metric</code> is not provided, the function selects a task-appropriate metric such as accuracy for classification or RMSE for regression. The argument <code>task = "auto"</code> intelligently detects whether you’re solving a classification or regression problem.</p>
<p>In the next section, we’ll explore how to compare the trained models using <code>summary()</code> and visualize key performance metrics.</p>
</section>
<section id="compare-model-performance" class="level2">
<h2 class="anchored" data-anchor-id="compare-model-performance">3. Compare Model Performance</h2>
<p>After training, you can summarize and compare all models using the <code>summary()</code> function. This gives a clear overview of model performance across a range of evaluation metrics:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(result, <span class="at">type =</span> <span class="st">"metrics"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
===== fastml Model Summary =====
Task: classification 
Number of Models Trained: 4 
Best Model(s): rand_forest (ranger) xgboost (xgboost) (accuracy: 0.9500000) 

Performance Metrics (Sorted by accuracy ):

------------------------------------------------------------------------------------------------------ 
Model         Engine   Accuracy   F1 Score   Kappa      Precision  Sensitivity  Specificity  ROC AUC   
------------------------------------------------------------------------------------------------------ 
rand_forest*  ranger   0.9500000  0.9473684  0.9000000  1.0000000  0.9000000    1.0000000    1.0000000 
xgboost*      xgboost  0.9500000  0.9473684  0.9000000  1.0000000  0.9000000    1.0000000    1.0000000 
logistic_reg  glm      0.9000000  0.8888889  0.8000000  1.0000000  0.8000000    1.0000000    0.9000000 
svm_rbf       kernlab  0.9000000  0.8888889  0.8000000  1.0000000  0.8000000    1.0000000    1.0000000 
------------------------------------------------------------------------------------------------------ 
(*Best model)</code></pre>
</div>
</div>
<p>Each row summarizes one model’s performance, including:</p>
<ul>
<li><p><strong>Accuracy:</strong> Overall classification correctness.</p></li>
<li><p><strong>F1 Score:</strong> Harmonic mean of precision and recall.</p></li>
<li><p><strong>Kappa:</strong> Agreement adjusted for chance.</p></li>
<li><p><strong>Precision:</strong> Proportion of positive predictions that were correct.</p></li>
<li><p><strong>Sensitivity (Recall):</strong> Ability to identify positive cases.</p></li>
<li><p><strong>Specificity:</strong> Ability to identify negative cases.</p></li>
<li><p><strong>ROC AUC:</strong> Area under the ROC curve; a measure of overall discriminative ability.</p></li>
</ul>
<p>The best-performing models (based on the selected <code>metric</code>) are marked with an asterisk <code>*</code>. In this case, both <code>rand_forest</code> and <code>xgboost</code> achieved the highest accuracy (0.95), making them the top candidates for deployment or further analysis.</p>
<p>Want to focus on just a few models? You can pass a subset using the algorithm argument in <code>summary()</code>.</p>
</section>
<section id="inspect-tuned-hyperparameters" class="level2">
<h2 class="anchored" data-anchor-id="inspect-tuned-hyperparameters">4. Inspect Tuned Hyperparameters</h2>
<p>To understand what made the top-performing models successful, use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(result, <span class="at">type =</span> <span class="st">"params"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Best Model hyperparameters:

Model: rand_forest (ranger) 
  mtry: 2
  trees: 500
  min_n: 10

Model: xgboost (xgboost) 
  mtry: 2
  trees: 15
  min_n: 2
  tree_depth: 6
  learn_rate: 0.1
  loss_reduction: 1
  sample_size: 0.5</code></pre>
</div>
</div>
<p>This will display the best hyperparameter values selected during tuning for each model. These settings are critical for optimizing performance and can inform further refinement or deployment.</p>
<p>These values are chosen based on cross-validation performance and reflect the best configuration for each algorithm on your specific dataset. The <code>fastml()</code> function handles this tuning process automatically, but if desired, you can manually set or constrain parameters using the <code>tune_params</code> argument.</p>
</section>
<section id="confusion-matrix" class="level2">
<h2 class="anchored" data-anchor-id="confusion-matrix">5. Confusion Matrix</h2>
<p>To evaluate model performance at the prediction level, especially for classification tasks, a confusion matrix offers detailed insight. Use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(result, <span class="at">type =</span> <span class="st">"conf_mat"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
===========================
Confusion Matrices by Model
===========================

Model: rand_forest (ranger) 
---------------------------
            Truth
Prediction   versicolor virginica
  versicolor          9         0
  virginica           1        10

Model: xgboost (xgboost) 
---------------------------
            Truth
Prediction   versicolor virginica
  versicolor          9         0
  virginica           1        10</code></pre>
</div>
</div>
<p>This displays the confusion matrices for each model, showing how well the predicted classes match the actual ones.</p>
<p>The result suggests both models performed very well on this binary classification task, with minimal confusion between the two classes. For datasets with imbalanced classes or more nuanced distinctions, confusion matrices can help pinpoint which types of errors are most common—false positives, false negatives, or both.</p>
<hr>
</section>
<section id="visualize-model-performance" class="level2">
<h2 class="anchored" data-anchor-id="visualize-model-performance">6. Visualize Model Performance</h2>
<p>To quickly compare how each model performed across different evaluation metrics, you can use the built-in <code>plot()</code> function with <code>type = "bar"</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(result, <span class="at">type =</span> <span class="st">"bar"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fastml-classification_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This generates a faceted bar plot, with one panel per metric (e.g., Accuracy, F1 Score, ROC AUC), and bars representing each model’s score on that metric.</p>
<p><strong>Why it’s useful</strong></p>
<ul>
<li><p>Provides a visual overview of strengths and weaknesses across models.</p></li>
<li><p>Makes it easy to spot trade-offs (e.g., high accuracy but lower sensitivity).</p></li>
<li><p>Highlights top-performing models for each metric.</p></li>
</ul>
<p>Each bar is color-coded by model, and the best-performing models stand out immediately. This is especially helpful when evaluating more than just one metric, such as both accuracy and F1 score, which can differ notably in imbalanced datasets.</p>
</section>
<section id="visualize-roc-curves" class="level2">
<h2 class="anchored" data-anchor-id="visualize-roc-curves">7. Visualize ROC Curves</h2>
<p>To assess the discriminative power of each model in a binary classification task, plot their Receiver Operating Characteristic (ROC) curves using:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(result, <span class="at">type =</span> <span class="st">"roc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fastml-classification_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This generates a faceted plot showing the ROC curve for each trained model.</p>
<p><strong>What ROC curves show</strong></p>
<ul>
<li><p>True Positive Rate (Sensitivity) vs.&nbsp;False Positive Rate (1 - Specificity) across thresholds.</p></li>
<li><p>The area under the curve (AUC) indicates overall model performance:</p>
<ul>
<li>AUC close to 1.0 suggests excellent discrimination.</li>
</ul>
<p>-AUC of 0.5 means no better than random guessing.</p></li>
</ul>
<p><strong>Why it’s helpful</strong></p>
<ul>
<li><p>Useful when dealing with imbalanced data, where accuracy may be misleading.</p></li>
<li><p>Allows comparison of how each model balances sensitivity and specificity.</p></li>
<li><p>Helps in selecting an optimal probability threshold for classification.</p></li>
</ul>
<p>In our example, both <code>rand_forest</code> and xgboost achieved an AUC of 1.0—indicating perfect separation of classes on the test set.</p>
<p>You can also zoom in on specific models using:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(result, <span class="at">type =</span> <span class="st">"roc"</span>, <span class="at">algorithm =</span> <span class="st">"rand_forest"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fastml-classification_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="visualize-calibration-plots" class="level2">
<h2 class="anchored" data-anchor-id="visualize-calibration-plots">8. Visualize Calibration Plots</h2>
<p>To evaluate how well your model’s predicted probabilities align with observed outcomes, use a calibration plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(result, <span class="at">type =</span> <span class="st">"calibration"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fastml-classification_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fastml-classification_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A calibration plot compares predicted probabilities to actual event rates. Well-calibrated models produce probabilities that match the true likelihood of outcomes—for example, among all observations predicted with 70% confidence, about 70% should actually belong to the positive class.</p>
<p><strong>What to look for</strong></p>
<ul>
<li><p>Diagonal line (ideal calibration): Perfect agreement between predicted and observed probabilities.</p></li>
<li><p>Model curves: Deviations from the diagonal indicate overconfidence (curve above the line) or underconfidence (curve below the line).</p></li>
<li><p>Rug plots: Tick marks on the x-axis show the distribution of predicted probabilities.</p></li>
</ul>
<p><strong>Why it matters</strong></p>
<ul>
<li><p>High accuracy doesn’t guarantee good probability estimates. Calibration assesses the reliability of those estimates.</p></li>
<li><p>Important for risk prediction, medical diagnosis, or any domain where predicted probabilities are used for decision-making.</p></li>
</ul>
<p>For binary classification tasks, calibration plots provide a deeper layer of model evaluation—especially when choosing between equally accurate models.</p>
</section>
<section id="predictions-on-new-data" class="level2">
<h2 class="anchored" data-anchor-id="predictions-on-new-data">9. Predictions on New Data</h2>
<p>Once you’ve identified the best-performing model, making predictions on new, unseen data is simple and consistent with the <code>predict()</code> function. The <code>fastml</code> package ensures that the appropriate preprocessing steps are automatically applied, so you can focus directly on generating and interpreting the predictions.</p>
<p>As a demonstration, let’s select a few random observations from the binary-classified iris dataset (<code>iris_bin</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>new_obs <span class="ot">&lt;-</span> iris_bin[<span class="sc">-</span><span class="dv">5</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">5</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>new_obs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Sepal.Length Sepal.Width Petal.Length Petal.Width
1          5.5         2.5          4.0         1.3
2          6.5         3.0          5.5         1.8
3          7.4         2.8          6.1         1.9
4          7.3         2.9          6.3         1.8
5          6.9         3.1          5.4         2.1</code></pre>
</div>
</div>
<p>This gives you 5 unseen flower samples, with measurements such as Sepal.Length, Petal.Width, etc.</p>
<p><strong>Predicting Classes</strong></p>
<p>To predict the class (versicolor or virginica) for each observation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(<span class="at">object =</span> result, <span class="at">newdata =</span> new_obs, <span class="at">type =</span> <span class="st">"class"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`rand_forest (ranger)`
[1] versicolor versicolor versicolor versicolor versicolor
Levels: versicolor virginica

$`xgboost (xgboost)`
[1] versicolor versicolor versicolor versicolor versicolor
Levels: versicolor virginica

attr(,"class")
[1] "fastml_prediction"</code></pre>
</div>
</div>
<ul>
<li><p>The result is a named list with one vector per best-performing model.</p></li>
<li><p>Each vector contains the predicted class (versicolor or virginica) for each observation in new_obs.</p></li>
<li><p>If multiple models tied in performance, predictions from each are shown (e.g., rand_forest and xgboost in this case).</p></li>
</ul>
<p>You can access specific model predictions like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(<span class="at">object =</span> result, <span class="at">newdata =</span> new_obs, <span class="at">type =</span> <span class="st">"class"</span>, <span class="at">model_name =</span> <span class="st">"rand_forest (ranger)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] versicolor versicolor versicolor versicolor versicolor
Levels: versicolor virginica</code></pre>
</div>
</div>
<p><strong>Predicting Class Probabilities</strong></p>
<p>In addition to class labels, you can obtain probability estimates for each class. This is especially useful when you need to assess the model’s confidence in its predictions or when applying a custom decision threshold.</p>
<p>Use the following command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(<span class="at">object =</span> result, <span class="at">newdata =</span> new_obs, <span class="at">type =</span> <span class="st">"prob"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`rand_forest (ranger)`
# A tibble: 5 × 2
  .pred_versicolor .pred_virginica
             &lt;dbl&gt;           &lt;dbl&gt;
1            0.859           0.141
2            0.859           0.141
3            0.859           0.141
4            0.859           0.141
5            0.859           0.141

$`xgboost (xgboost)`
# A tibble: 5 × 2
  .pred_versicolor .pred_virginica
             &lt;dbl&gt;           &lt;dbl&gt;
1            0.816           0.184
2            0.816           0.184
3            0.816           0.184
4            0.816           0.184
5            0.816           0.184

attr(,"class")
[1] "fastml_prediction"</code></pre>
</div>
</div>
<p>Each sublist contains a tibble with predicted probabilities for each class, corresponding to the rows in new_obs.</p>
<p>This is useful when:</p>
<ul>
<li><p>To adjust thresholds for sensitivity/specificity trade-offs</p></li>
<li><p>To rank cases based on prediction confidence</p></li>
<li><p>For risk scoring or clinical triage tasks</p></li>
</ul>
<p>Both class labels and probabilities are powered by the final model trained and selected via <code>fastml()</code>—you don’t need to manually reapply recipes or preprocessing steps.</p>
<p>In the next step, you can use SHAP explanations to understand why the model made these predictions.</p>
</section>
<section id="model-explainability" class="level2">
<h2 class="anchored" data-anchor-id="model-explainability">10. Model Explainability</h2>
<p>Understanding why a model makes a certain prediction is just as important as how accurate it is—especially in fields like healthcare, finance, and policy. The <code>fastexplain()</code> function in fastml integrates with the DALEX package to provide a suite of explainability tools.</p>
<p>Run the following to generate explanations for the best model(s):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fastexplain</span>(result)       </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Preparation of a new explainer is initiated
  -&gt; model label       :  rand_forest (ranger) 
  -&gt; data              :  80  rows  4  cols 
  -&gt; data              :  tibble converted into a data.frame 
  -&gt; target variable   :  80  values 
  -&gt; predict function  :  predict_function 
  -&gt; predicted values  :  No value for predict function target column. (  default  )
  -&gt; model_info        :  package , ver. , task classification 
  -&gt; predicted values  :  predict function returns multiple columns:  2  (  default  ) 
  A new explainer has been created!  
Preparation of a new explainer is initiated
  -&gt; model label       :  xgboost (xgboost) 
  -&gt; data              :  80  rows  4  cols 
  -&gt; data              :  tibble converted into a data.frame 
  -&gt; target variable   :  80  values 
  -&gt; predict function  :  predict_function 
  -&gt; predicted values  :  No value for predict function target column. (  default  )
  -&gt; model_info        :  package , ver. , task classification 
  -&gt; predicted values  :  predict function returns multiple columns:  2  (  default  ) 
  A new explainer has been created!  

=== DALEX Variable Importance (with Boxplots) ===</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fastml-classification_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== DALEX Shapley Values (SHAP) ===</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="fastml-classification_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This process wraps your trained models into DALEX explainers, enabling multiple forms of model interpretation.</p>
<p><strong>What you get</strong></p>
<p>Once the explainers are created, several plots and summaries are available:</p>
<ul>
<li><p><strong>Permutation-based Variable Importance:</strong> Quantifies the contribution of each feature to model accuracy by measuring the drop in performance when the feature is randomly permuted.</p></li>
<li><p><strong>SHAP Values (Shapley Additive Explanations):</strong> Breaks down individual predictions into feature-level contributions, helping you understand why a particular prediction was made.</p></li>
<li><p><strong>Partial Dependence and Model Profiles:</strong> Visualizes how predictions change across a range of values for a selected feature, isolating its effect while averaging out others.</p></li>
</ul>
</section>
<section id="advanced-options-cheatsheet" class="level2">
<h2 class="anchored" data-anchor-id="advanced-options-cheatsheet">Advanced Options Cheat‑Sheet</h2>
<p>The <code>fastml()</code> function supports a variety of advanced arguments to give you full control over your machine learning pipeline. Here’s a quick reference:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Argument</th>
<th>Purpose</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>recipe</code></td>
<td>Supply a custom <a href="https://recipes.tidymodels.org"><strong>recipes</strong></a> object to override the automatic preprocessing pipeline</td>
<td><code>recipe(Species ~ ., data = iris_bin) %&gt;% step_normalize(all_numeric())</code></td>
</tr>
<tr class="even">
<td><code>impute_method</code></td>
<td>Specify how missing values are handled. Supported methods include <code>"medianImpute"</code>, <code>"mice"</code>, <code>"missForest"</code>, <code>"knnImpute"</code>, and more</td>
<td><code>impute_method = "knnImpute"</code></td>
</tr>
<tr class="odd">
<td><code>algorithm_engines</code></td>
<td>Customize which engine is used for each algorithm</td>
<td><code>list(rand_forest = "randomForest", svm_rbf = "kernlab")</code></td>
</tr>
<tr class="even">
<td><code>tuning_strategy</code></td>
<td>Choose hyperparameter search strategy: <code>"grid"</code> (default) or <code>"bayes"</code> (Bayesian optimization with optional <code>early_stopping</code>)</td>
<td><code>tuning_strategy = "bayes", tuning_iterations = 25</code></td>
</tr>
<tr class="odd">
<td><code>learning_curve</code></td>
<td>Generate learning curves to visualize performance vs.&nbsp;training size</td>
<td><code>learning_curve = TRUE</code></td>
</tr>
</tbody>
</table>
<p>These options allow for deeper experimentation and optimization, especially when working with complex datasets or performance-critical tasks.</p>
<p>Tip: Explore <code>?fastml</code> in your R console to see the full list of arguments and their descriptions.</p>
<p>By combining ease of use with advanced flexibility, <code>fastml</code> helps both beginners and experienced users build robust, interpretable, and high-performing machine learning models.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>